<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="879px" preserveAspectRatio="none" style="width:1334px;height:879px;background:#FFFFFF;" version="1.1" viewBox="0 0 1334 879" width="1334px" zoomAndPan="magnify"><defs/><g><rect height="26.2969" id="_title" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="429" x="451.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="419" x="456.5" y="27.9951">Deep Archive Collection Manual Migration Workflow</text><rect fill="#FFFFFF" height="660.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="128.5938"/><rect fill="#FFFFFF" height="182.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="416" y="319.9219"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="658" y="501.9844"/><rect fill="#FFFFFF" height="88.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="852" y="546.25"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1084" y="605.6484"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1235" y="679.0469"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="289" x2="289" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="421" x2="421" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="662.5" x2="662.5" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="856.5" x2="856.5" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1089" x2="1089" y1="118.5938" y2="798.5781"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1240" x2="1240" y1="118.5938" y2="798.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="18" y="115.292">Operator</text><ellipse cx="54" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54,58.7969 L54,85.7969 M41,66.7969 L67,66.7969 M54,85.7969 L41,100.7969 M54,85.7969 L67,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="18" y="810.5732">Operator</text><ellipse cx="54" cy="822.375" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54,830.375 L54,857.375 M41,838.375 L67,838.375 M54,857.375 L41,872.375 M54,857.375 L67,872.375 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="222" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="229" y="107.292">Cumulus Console</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="222" y="797.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="229" y="817.5732">Cumulus Console</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="366" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="373" y="107.292">ORCA Bucket</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="366" y="797.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="373" y="817.5732">ORCA Bucket</text><path d="M599.5,92.2969 L726.5,92.2969 C731.5,92.2969 731.5,105.4453 731.5,105.4453 C731.5,105.4453 731.5,118.5938 726.5,118.5938 L599.5,118.5938 C594.5,118.5938 594.5,105.4453 594.5,105.4453 C594.5,105.4453 594.5,92.2969 599.5,92.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M726.5,92.2969 C721.5,92.2969 721.5,105.4453 721.5,105.4453 C721.5,118.5938 726.5,118.5938 726.5,118.5938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="599.5" y="110.292">Migration Queue</text><path d="M599.5,797.5781 L726.5,797.5781 C731.5,797.5781 731.5,810.7266 731.5,810.7266 C731.5,810.7266 731.5,823.875 726.5,823.875 L599.5,823.875 C594.5,823.875 594.5,810.7266 594.5,810.7266 C594.5,810.7266 594.5,797.5781 599.5,797.5781 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M726.5,797.5781 C721.5,797.5781 721.5,810.7266 721.5,810.7266 C721.5,823.875 726.5,823.875 726.5,823.875 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="599.5" y="815.5732">Migration Queue</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="759.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="766.5" y="107.292">Database Update Service</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="759.5" y="797.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="766.5" y="817.5732">Database Update Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="1036" y="115.292">ORCA Catalog</text><path d="M1071,66.2969 C1071,56.2969 1089,56.2969 1089,56.2969 C1089,56.2969 1107,56.2969 1107,66.2969 L1107,92.2969 C1107,102.2969 1089,102.2969 1089,102.2969 C1089,102.2969 1071,102.2969 1071,92.2969 L1071,66.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1071,66.2969 C1071,76.2969 1089,76.2969 1089,76.2969 C1089,76.2969 1107,76.2969 1107,66.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="1036" y="810.5732">ORCA Catalog</text><path d="M1071,823.875 C1071,813.875 1089,813.875 1089,813.875 C1089,813.875 1107,813.875 1107,823.875 L1107,849.875 C1107,859.875 1089,859.875 1089,859.875 C1089,859.875 1071,859.875 1071,849.875 L1071,823.875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1071,823.875 C1071,833.875 1089,833.875 1089,833.875 C1089,833.875 1107,833.875 1107,823.875 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="1152" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="1159" y="107.292">Internal Reconciliation</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="1152" y="797.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="1159" y="817.5732">Internal Reconciliation</text><rect fill="#FFFFFF" height="660.9844" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="128.5938"/><rect fill="#FFFFFF" height="182.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="416" y="319.9219"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="658" y="501.9844"/><rect fill="#FFFFFF" height="88.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="852" y="546.25"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1084" y="605.6484"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1235" y="679.0469"/><polygon fill="#008000" points="277,160.8594,287,164.8594,277,168.8594,281,164.8594" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="59" x2="283" y1="164.8594" y2="164.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66" y="152.2271">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="79" y="144.6606">Configure ORCA for Deep</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="79" y="159.7935">Archive for all collections</text><path d="M5,177.8594 L5,247.8594 L338,247.8594 L338,187.8594 L328,177.8594 L5,177.8594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M328,177.8594 L328,187.8594 L338,187.8594 L328,177.8594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="28" y="194.9263">Changing to Deep Archive for all collections</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="28" y="210.0591">can be done by redeploying Cumulus and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="28" y="225.1919">setting the orca_default_storage_class</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="28" y="240.3247">to DEEP_ARCHIVE</text><polygon fill="#008000" points="404,315.9219,414,319.9219,404,323.9219,408,319.9219" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="59" x2="410" y1="319.9219" y2="319.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66" y="292.1567">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="79" y="269.4575">Change bucket lifecycle policy</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="79" y="284.5903">by setting transition_days = 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="79" y="299.7231">and DEEP ARCHIVE as storage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="79" y="314.856">type</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="426" x2="468" y1="364.1875" y2="364.1875"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="468" x2="468" y1="364.1875" y2="377.1875"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="427" x2="468" y1="377.1875" y2="377.1875"/><polygon fill="#FF0000" points="437,373.1875,427,377.1875,437,381.1875,433,377.1875" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="433" y="351.5552">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="445" y="343.9888">Files transitioned to DEEP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="445" y="359.1216">ARCHIVE storage</text><path d="M322,390.1875 L322,430.1875 L519,430.1875 L519,400.1875 L509,390.1875 L322,390.1875 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M509,390.1875 L509,400.1875 L519,400.1875 L509,390.1875 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="328" y="407.2544">Migration to DEEP_ARCHIVE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="328" y="422.3872">can take up to 48 hours.</text><polygon fill="#008000" points="646,497.9844,656,501.9844,646,505.9844,650,501.9844" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="421" x2="652" y1="501.9844" y2="501.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="428" y="474.2192">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="441" y="451.52">Migrated files trigger a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="441" y="466.6528">s3:LifecycleTransition action</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="441" y="481.7856">which sends a message to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="441" y="496.9185">migration queue</text><polygon fill="#008000" points="674,542.25,664,546.25,674,550.25,670,546.25" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="668" x2="851" y1="546.25" y2="546.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="680" y="533.6177">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="693" y="526.0513">Retrieves messages of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="693" y="541.1841">transition files</text><polygon fill="#008000" points="1072,601.6484,1082,605.6484,1072,609.6484,1076,605.6484" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="862" x2="1078" y1="605.6484" y2="605.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="869" y="585.4497">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="882" y="570.3169">Updates the storage type for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="882" y="585.4497">transitioned files to DEEP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="882" y="600.5825">ARCHIVE</text><polygon fill="#FF0000" points="868,630.7813,858,634.7813,868,638.7813,864,634.7813" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="862" x2="1088" y1="634.7813" y2="634.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="874" y="629.7153">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="887" y="629.7153">Returns update confirmation</text><polygon fill="#008000" points="1223,675.0469,1233,679.0469,1223,683.0469,1227,679.0469" style="stroke:#008000;stroke-width:1.0;"/><line style="stroke:#008000;stroke-width:1.0;" x1="59" x2="1229" y1="679.0469" y2="679.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="66" y="666.4146">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="79" y="658.8481">Request for internal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="79" y="673.981">reconciliation mismatch report</text><polygon fill="#FF0000" points="70,704.1797,60,708.1797,70,712.1797,66,708.1797" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64" x2="1239" y1="708.1797" y2="708.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="76" y="703.1138">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="89" y="703.1138">Returns mismatch report</text><line style="stroke:#FF0000;stroke-width:1.0;" x1="59" x2="101" y1="767.5781" y2="767.5781"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="101" x2="101" y1="767.5781" y2="780.5781"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="60" x2="101" y1="780.5781" y2="780.5781"/><polygon fill="#FF0000" points="70,776.5781,60,780.5781,70,784.5781,66,780.5781" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="66" y="747.3794">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="89" y="732.2466">Analyze mismatch report for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="89" y="747.3794">storage discrepancies and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="89" y="762.5122">resolves them</text><!--MD5=[4c5cc94764450226e4df874f77dcd0e4]
@startuml
skinparam maxMessageSize 200


title "Deep Archive Collection Manual Migration Workflow"
 
actor Operator as operator
participant "Cumulus Console" as cc
participant "ORCA Bucket" as ob


queue "Migration Queue" as mq
participant "Database Update Service" as dus
database "ORCA Catalog" as oc
participant "Internal Reconciliation" as ir
autonumber
activate operator

operator-[#green]> cc: Configure ORCA for Deep Archive for all collections
note over operator,cc
Changing to Deep Archive for all collections
can be done by redeploying Cumulus and 
setting the orca_default_storage_class 
to DEEP_ARCHIVE
end note
operator-[#green]> ob: Change bucket lifecycle policy by setting transition_days = 0 and DEEP ARCHIVE as storage type
activate ob
ob-[#red]> ob: Files transitioned to DEEP ARCHIVE storage

note over ob
Migration to DEEP_ARCHIVE
can take up to 48 hours.
end note

ob-[#green]> mq: Migrated files trigger a s3:LifecycleTransition action which sends a message to the migration queue
deactivate ob
activate mq
dus-[#green]> mq: Retrieves messages of transition files
deactivate mq
activate dus
dus-[#green]> oc: Updates the storage type for transitioned files to DEEP ARCHIVE
activate oc
oc- -[#red]> dus: Returns update confirmation
deactivate oc
deactivate dus
operator-[#green]> ir: Request for internal reconciliation mismatch report
activate ir
ir- -[#red]> operator: Returns mismatch report
deactivate ir
operator-[#red]> operator: Analyze mismatch report for storage discrepancies and resolves them
@enduml

PlantUML version 1.2022.7beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>